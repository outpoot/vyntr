name: Security Scans

on:
  schedule:
    - cron: '0 2 * * 1' # Run weekly on Mondays at 2 AM
  workflow_dispatch:

jobs:
  security-scan:
    name: Security Scans
    runs-on: ubuntu-latest
    strategy:
      matrix:
        component: [genesis, pulse, lexicon, website]
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Run Rust Security Audit
        if: matrix.component == 'genesis' || matrix.component == 'pulse'
        run: |
          cd ${{ matrix.component }}
          cargo install cargo-audit
          cargo audit --ignore RUSTSEC-2020-0071 || echo "Warning: Security issues found, review the report"
      
      - name: Run Python Security Audit
        if: matrix.component == 'lexicon'
        run: |
          cd lexicon/tools
          python -m pip install safety
          if [ -f "requirements.txt" ]; then
            safety check -r requirements.txt || echo "Warning: Security issues found, review the report"
          else
            echo "No requirements.txt found in lexicon/tools, skipping security scan"
          fi
      
      - name: Run NPM Security Audit
        if: matrix.component == 'website'
        run: |
          cd website
          npm audit --production || echo "Warning: Security issues found, review the report"